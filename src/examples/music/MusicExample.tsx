import { useEffect, useRef, useState } from "react";
import { SimpleTable, TableRefType, Theme, Row } from "simple-table-core";

import "simple-table-core/styles.css";
import "./MusicTheme.css";
import { HEADERS } from "./music-headers";

const BACKUP_MUSIC_DATA = [
  {
    id: "artist-41",
    rank: 41,
    artistName: "Travis Scott",
    artistType: "Band",
    pronouns: "They/Them",
    recordLabel: "YG Entertainment",
    lyricsLanguage: "Portuguese",
    growthStatus: "Declining",
    mood: "Heartbroken",
    genre: "alternative",
    followers: 198585436,
    followersFormatted: "198.59M",
    followersGrowth: 4178894,
    followersGrowthFormatted: "4.18M",
    followersGrowthPercent: 2.1,
    followers7DayGrowth: 119033,
    followers7DayGrowthPercent: 0.06,
    followers28DayGrowth: 1336415,
    followers28DayGrowthPercent: 0.67,
    followers60DayGrowth: 604255,
    followers60DayGrowthPercent: 0.3,
    popularity: 93,
    popularityChange: -4,
    popularityChangePercent: -4.3,
    playlistReach: 497727778,
    playlistReachFormatted: "497.73M",
    playlistReachChange: 78428470,
    playlistReachChangeFormatted: "78.43M",
    playlistReachChangePercent: 15.76,
    playlistReach7DayGrowth: 14061556,
    playlistReach7DayGrowthPercent: 2.83,
    playlistReach28DayGrowth: 50904258,
    playlistReach28DayGrowthPercent: 10.23,
    playlistReach60DayGrowth: 35502301,
    playlistReach60DayGrowthPercent: 7.13,
    playlistCount: 2964,
    playlistCountGrowth: 19,
    playlistCountGrowthPercent: 0.64,
    playlistCount7DayGrowth: 12,
    playlistCount7DayGrowthPercent: 0.4,
    playlistCount28DayGrowth: 43,
    playlistCount28DayGrowthPercent: 1.45,
    playlistCount60DayGrowth: 65,
    playlistCount60DayGrowthPercent: 2.19,
    monthlyListeners: 52446991,
    monthlyListenersFormatted: "52.45M",
    monthlyListenersChange: 5871115,
    monthlyListenersChangeFormatted: "5.87M",
    monthlyListenersChangePercent: 11.19,
    monthlyListeners7DayGrowth: -740227,
    monthlyListeners7DayGrowthPercent: -1.41,
    monthlyListeners28DayGrowth: 14474263,
    monthlyListeners28DayGrowthPercent: 27.6,
    monthlyListeners60DayGrowth: 21606505,
    monthlyListeners60DayGrowthPercent: 41.2,
    conversionRate: 3.18,
    reachFollowersRatio: 2.51,
  },
  {
    id: "artist-32",
    rank: 32,
    artistName: "Rosal√≠a",
    artistType: "Group",
    pronouns: "They/Them",
    recordLabel: "T-Series",
    lyricsLanguage: "Punjabi",
    growthStatus: "Steady",
    mood: "Melancholic",
    genre: "country",
    followers: 196327654,
    followersFormatted: "196.33M",
    followersGrowth: 4525682,
    followersGrowthFormatted: "4.53M",
    followersGrowthPercent: 2.31,
    followers7DayGrowth: 124168,
    followers7DayGrowthPercent: 0.06,
    followers28DayGrowth: 1626800,
    followers28DayGrowthPercent: 0.83,
    followers60DayGrowth: 1180724,
    followers60DayGrowthPercent: 0.6,
    popularity: 88,
    popularityChange: -4,
    popularityChangePercent: -4.55,
    playlistReach: 518598617,
    playlistReachFormatted: "518.60M",
    playlistReachChange: 22843483,
    playlistReachChangeFormatted: "22.84M",
    playlistReachChangePercent: 4.4,
    playlistReach7DayGrowth: 12660960,
    playlistReach7DayGrowthPercent: 2.44,
    playlistReach28DayGrowth: 21789766,
    playlistReach28DayGrowthPercent: 4.2,
    playlistReach60DayGrowth: 21750730,
    playlistReach60DayGrowthPercent: 4.19,
    playlistCount: 3215,
    playlistCountGrowth: 50,
    playlistCountGrowthPercent: 1.56,
    playlistCount7DayGrowth: 4,
    playlistCount7DayGrowthPercent: 0.12,
    playlistCount28DayGrowth: 41,
    playlistCount28DayGrowthPercent: 1.28,
    playlistCount60DayGrowth: 71,
    playlistCount60DayGrowthPercent: 2.21,
    monthlyListeners: 116043054,
    monthlyListenersFormatted: "116.04M",
    monthlyListenersChange: 2944608,
    monthlyListenersChangeFormatted: "2.94M",
    monthlyListenersChangePercent: 2.54,
    monthlyListeners7DayGrowth: 2729911,
    monthlyListeners7DayGrowthPercent: 2.35,
    monthlyListeners28DayGrowth: 12293004,
    monthlyListeners28DayGrowthPercent: 10.59,
    monthlyListeners60DayGrowth: 19845704,
    monthlyListeners60DayGrowthPercent: 17.1,
    conversionRate: 7.01,
    reachFollowersRatio: 2.64,
  },
  {
    id: "artist-12",
    rank: 12,
    artistName: "Lana Del Rey",
    artistType: "Band",
    pronouns: "They/Them",
    recordLabel: "UMG (Republic Records)",
    lyricsLanguage: "Spanish",
    growthStatus: "Trending",
    mood: "Empowering",
    genre: "punjabi",
    followers: 192859936,
    followersFormatted: "192.86M",
    followersGrowth: 2518298,
    followersGrowthFormatted: "2.52M",
    followersGrowthPercent: 1.31,
    followers7DayGrowth: 462894,
    followers7DayGrowthPercent: 0.24,
    followers28DayGrowth: 375791,
    followers28DayGrowthPercent: 0.19,
    followers60DayGrowth: 1230431,
    followers60DayGrowthPercent: 0.64,
    popularity: 72,
    popularityChange: -1,
    popularityChangePercent: -1.39,
    playlistReach: 988198871,
    playlistReachFormatted: "988.20M",
    playlistReachChange: 47527578,
    playlistReachChangeFormatted: "47.53M",
    playlistReachChangePercent: 4.81,
    playlistReach7DayGrowth: -1283648,
    playlistReach7DayGrowthPercent: -0.13,
    playlistReach28DayGrowth: 11455187,
    playlistReach28DayGrowthPercent: 1.16,
    playlistReach60DayGrowth: 43278850,
    playlistReach60DayGrowthPercent: 4.38,
    playlistCount: 618,
    playlistCountGrowth: 11,
    playlistCountGrowthPercent: 1.78,
    playlistCount7DayGrowth: 17,
    playlistCount7DayGrowthPercent: 2.75,
    playlistCount28DayGrowth: 36,
    playlistCount28DayGrowthPercent: 5.83,
    playlistCount60DayGrowth: 54,
    playlistCount60DayGrowthPercent: 8.74,
    monthlyListeners: 114478965,
    monthlyListenersFormatted: "114.48M",
    monthlyListenersChange: -4937230,
    monthlyListenersChangeFormatted: "-4937230",
    monthlyListenersChangePercent: -4.31,
    monthlyListeners7DayGrowth: 2834630,
    monthlyListeners7DayGrowthPercent: 2.48,
    monthlyListeners28DayGrowth: 553656,
    monthlyListeners28DayGrowthPercent: 0.48,
    monthlyListeners60DayGrowth: -3316166,
    monthlyListeners60DayGrowthPercent: -2.9,
    conversionRate: 0.46,
    reachFollowersRatio: 5.12,
  },
  {
    id: "artist-44",
    rank: 44,
    artistName: "Imagine Dragons",
    artistType: "Band",
    pronouns: "They/Them",
    recordLabel: "Warner Music Group (Atlantic Records)",
    lyricsLanguage: "Spanish",
    growthStatus: "Declining",
    mood: "Uplifting",
    genre: "latin",
    followers: 184166386,
    followersFormatted: "184.17M",
    followersGrowth: 651330,
    followersGrowthFormatted: "651.33K",
    followersGrowthPercent: 0.35,
    followers7DayGrowth: 423792,
    followers7DayGrowthPercent: 0.23,
    followers28DayGrowth: 1519122,
    followers28DayGrowthPercent: 0.82,
    followers60DayGrowth: 1932352,
    followers60DayGrowthPercent: 1.05,
    popularity: 74,
    popularityChange: 4,
    popularityChangePercent: 5.41,
    playlistReach: 703636234,
    playlistReachFormatted: "703.64M",
    playlistReachChange: 58635236,
    playlistReachChangeFormatted: "58.64M",
    playlistReachChangePercent: 8.33,
    playlistReach7DayGrowth: 11066701,
    playlistReach7DayGrowthPercent: 1.57,
    playlistReach28DayGrowth: 24682800,
    playlistReach28DayGrowthPercent: 3.51,
    playlistReach60DayGrowth: 47897358,
    playlistReach60DayGrowthPercent: 6.81,
    playlistCount: 3040,
    playlistCountGrowth: 50,
    playlistCountGrowthPercent: 1.64,
    playlistCount7DayGrowth: 7,
    playlistCount7DayGrowthPercent: 0.23,
    playlistCount28DayGrowth: 11,
    playlistCount28DayGrowthPercent: 0.36,
    playlistCount60DayGrowth: 81,
    playlistCount60DayGrowthPercent: 2.66,
    monthlyListeners: 72760178,
    monthlyListenersFormatted: "72.76M",
    monthlyListenersChange: 8148723,
    monthlyListenersChangeFormatted: "8.15M",
    monthlyListenersChangePercent: 11.2,
    monthlyListeners7DayGrowth: 5219282,
    monthlyListeners7DayGrowthPercent: 7.17,
    monthlyListeners28DayGrowth: -1081903,
    monthlyListeners28DayGrowthPercent: -1.49,
    monthlyListeners60DayGrowth: 22906565,
    monthlyListeners60DayGrowthPercent: 31.48,
    conversionRate: 5.65,
    reachFollowersRatio: 3.82,
  },
  {
    id: "artist-33",
    rank: 33,
    artistName: "NewJeans",
    artistType: "Band",
    pronouns: "They/Them",
    recordLabel: "UMG (Interscope)",
    lyricsLanguage: "Punjabi",
    growthStatus: "Trending",
    mood: "Celebratory",
    genre: "reggaeton",
    followers: 182724824,
    followersFormatted: "182.72M",
    followersGrowth: 2326725,
    followersGrowthFormatted: "2.33M",
    followersGrowthPercent: 1.27,
    followers7DayGrowth: 352317,
    followers7DayGrowthPercent: 0.19,
    followers28DayGrowth: 318107,
    followers28DayGrowthPercent: 0.17,
    followers60DayGrowth: 952530,
    followers60DayGrowthPercent: 0.52,
    popularity: 75,
    popularityChange: -4,
    popularityChangePercent: -5.33,
    playlistReach: 533752831,
    playlistReachFormatted: "533.75M",
    playlistReachChange: 37901786,
    playlistReachChangeFormatted: "37.90M",
    playlistReachChangePercent: 7.1,
    playlistReach7DayGrowth: -866392,
    playlistReach7DayGrowthPercent: -0.16,
    playlistReach28DayGrowth: 34196823,
    playlistReach28DayGrowthPercent: 6.41,
    playlistReach60DayGrowth: -2570384,
    playlistReach60DayGrowthPercent: -0.48,
    playlistCount: 2385,
    playlistCountGrowth: 16,
    playlistCountGrowthPercent: 0.67,
    playlistCount7DayGrowth: 21,
    playlistCount7DayGrowthPercent: 0.88,
    playlistCount28DayGrowth: 18,
    playlistCount28DayGrowthPercent: 0.75,
    playlistCount60DayGrowth: 10,
    playlistCount60DayGrowthPercent: 0.42,
    monthlyListeners: 133771985,
    monthlyListenersFormatted: "133.77M",
    monthlyListenersChange: -4674133,
    monthlyListenersChangeFormatted: "-4674133",
    monthlyListenersChangePercent: -3.49,
    monthlyListeners7DayGrowth: -145080,
    monthlyListeners7DayGrowthPercent: -0.11,
    monthlyListeners28DayGrowth: -3441172,
    monthlyListeners28DayGrowthPercent: -2.57,
    monthlyListeners60DayGrowth: 16444220,
    monthlyListeners60DayGrowthPercent: 12.29,
    conversionRate: 9.27,
    reachFollowersRatio: 2.92,
  },
  {
    id: "artist-21",
    rank: 21,
    artistName: "Bruno Mars",
    artistType: "Solo Artist",
    pronouns: "They/Them",
    recordLabel: "UMG (Interscope)",
    lyricsLanguage: "Hindi",
    growthStatus: "Declining",
    mood: "Empowering",
    genre: "alternative",
    followers: 178819255,
    followersFormatted: "178.82M",
    followersGrowth: 4881064,
    followersGrowthFormatted: "4.88M",
    followersGrowthPercent: 2.73,
    followers7DayGrowth: 216822,
    followers7DayGrowthPercent: 0.12,
    followers28DayGrowth: 884578,
    followers28DayGrowthPercent: 0.49,
    followers60DayGrowth: 2225871,
    followers60DayGrowthPercent: 1.24,
    popularity: 89,
    popularityChange: 1,
    popularityChangePercent: 1.12,
    playlistReach: 712553628,
    playlistReachFormatted: "712.55M",
    playlistReachChange: 72303426,
    playlistReachChangeFormatted: "72.30M",
    playlistReachChangePercent: 10.15,
    playlistReach7DayGrowth: -1685079,
    playlistReach7DayGrowthPercent: -0.24,
    playlistReach28DayGrowth: 55381473,
    playlistReach28DayGrowthPercent: 7.77,
    playlistReach60DayGrowth: 85626226,
    playlistReach60DayGrowthPercent: 12.02,
    playlistCount: 1980,
    playlistCountGrowth: 5,
    playlistCountGrowthPercent: 0.25,
    playlistCount7DayGrowth: 19,
    playlistCount7DayGrowthPercent: 0.96,
    playlistCount28DayGrowth: 13,
    playlistCount28DayGrowthPercent: 0.66,
    playlistCount60DayGrowth: 31,
    playlistCount60DayGrowthPercent: 1.57,
    monthlyListeners: 111194351,
    monthlyListenersFormatted: "111.19M",
    monthlyListenersChange: 1491343,
    monthlyListenersChangeFormatted: "1.49M",
    monthlyListenersChangePercent: 1.34,
    monthlyListeners7DayGrowth: 1680606,
    monthlyListeners7DayGrowthPercent: 1.51,
    monthlyListeners28DayGrowth: 6410540,
    monthlyListeners28DayGrowthPercent: 5.77,
    monthlyListeners60DayGrowth: 20779008,
    monthlyListeners60DayGrowthPercent: 18.69,
    conversionRate: 1.74,
    reachFollowersRatio: 3.98,
  },
  {
    id: "artist-9",
    rank: 9,
    artistName: "Yo Yo Honey Singh",
    artistType: "Band",
    pronouns: "They/Them",
    recordLabel: "HYBE (Big Hit Music)",
    lyricsLanguage: "Spanish",
    growthStatus: "Steady",
    mood: "Empowering",
    genre: "alternative",
    followers: 173025579,
    followersFormatted: "173.03M",
    followersGrowth: 3023639,
    followersGrowthFormatted: "3.02M",
    followersGrowthPercent: 1.75,
    followers7DayGrowth: 330288,
    followers7DayGrowthPercent: 0.19,
    followers28DayGrowth: 998593,
    followers28DayGrowthPercent: 0.58,
    followers60DayGrowth: 2340929,
    followers60DayGrowthPercent: 1.35,
    popularity: 77,
    popularityChange: 3,
    popularityChangePercent: 3.9,
    playlistReach: 869786080,
    playlistReachFormatted: "869.79M",
    playlistReachChange: 1739087,
    playlistReachChangeFormatted: "1.74M",
    playlistReachChangePercent: 0.2,
    playlistReach7DayGrowth: 13856192,
    playlistReach7DayGrowthPercent: 1.59,
    playlistReach28DayGrowth: 21458446,
    playlistReach28DayGrowthPercent: 2.47,
    playlistReach60DayGrowth: 110707209,
    playlistReach60DayGrowthPercent: 12.73,
    playlistCount: 1933,
    playlistCountGrowth: 12,
    playlistCountGrowthPercent: 0.62,
    playlistCount7DayGrowth: 14,
    playlistCount7DayGrowthPercent: 0.72,
    playlistCount28DayGrowth: 23,
    playlistCount28DayGrowthPercent: 1.19,
    playlistCount60DayGrowth: 93,
    playlistCount60DayGrowthPercent: 4.81,
    monthlyListeners: 79233783,
    monthlyListenersFormatted: "79.23M",
    monthlyListenersChange: 6383519,
    monthlyListenersChangeFormatted: "6.38M",
    monthlyListenersChangePercent: 8.06,
    monthlyListeners7DayGrowth: 463837,
    monthlyListeners7DayGrowthPercent: 0.59,
    monthlyListeners28DayGrowth: -2589756,
    monthlyListeners28DayGrowthPercent: -3.27,
    monthlyListeners60DayGrowth: 9606710,
    monthlyListeners60DayGrowthPercent: 12.12,
    conversionRate: 3.42,
    reachFollowersRatio: 5.03,
  },
  {
    id: "artist-1",
    rank: 1,
    artistName: "Burna Boy",
    artistType: "Solo Artist",
    pronouns: "He/Him",
    recordLabel: "Epic Records",
    lyricsLanguage: "English",
    growthStatus: "Declining",
    mood: "Romantic",
    genre: "country",
    followers: 171281171,
    followersFormatted: "171.28M",
    followersGrowth: 1889545,
    followersGrowthFormatted: "1.89M",
    followersGrowthPercent: 1.1,
    followers7DayGrowth: 91603,
    followers7DayGrowthPercent: 0.05,
    followers28DayGrowth: 511448,
    followers28DayGrowthPercent: 0.3,
    followers60DayGrowth: 1600364,
    followers60DayGrowthPercent: 0.93,
    popularity: 84,
    popularityChange: 1,
    popularityChangePercent: 1.19,
    playlistReach: 659416884,
    playlistReachFormatted: "659.42M",
    playlistReachChange: 78991437,
    playlistReachChangeFormatted: "78.99M",
    playlistReachChangePercent: 11.98,
    playlistReach7DayGrowth: 2574999,
    playlistReach7DayGrowthPercent: 0.39,
    playlistReach28DayGrowth: 73755044,
    playlistReach28DayGrowthPercent: 11.18,
    playlistReach60DayGrowth: 119079242,
    playlistReach60DayGrowthPercent: 18.06,
    playlistCount: 558,
    playlistCountGrowth: 25,
    playlistCountGrowthPercent: 4.48,
    playlistCount7DayGrowth: 18,
    playlistCount7DayGrowthPercent: 3.23,
    playlistCount28DayGrowth: 8,
    playlistCount28DayGrowthPercent: 1.43,
    playlistCount60DayGrowth: 23,
    playlistCount60DayGrowthPercent: 4.12,
    monthlyListeners: 32307032,
    monthlyListenersFormatted: "32.31M",
    monthlyListenersChange: -1916547,
    monthlyListenersChangeFormatted: "-1916547",
    monthlyListenersChangePercent: -5.93,
    monthlyListeners7DayGrowth: 7500649,
    monthlyListeners7DayGrowthPercent: 23.22,
    monthlyListeners28DayGrowth: 14954452,
    monthlyListeners28DayGrowthPercent: 46.29,
    monthlyListeners60DayGrowth: 18518373,
    monthlyListeners60DayGrowthPercent: 57.32,
    conversionRate: 2.52,
    reachFollowersRatio: 3.85,
  },
  {
    id: "artist-3",
    rank: 3,
    artistName: "Frank Ocean",
    artistType: "Group",
    pronouns: "They/Them",
    recordLabel: "Warner Music Group (Atlantic Records)",
    lyricsLanguage: "Korean",
    growthStatus: "Trending",
    mood: "Energetic",
    genre: "k-pop",
    followers: 170540088,
    followersFormatted: "170.54M",
    followersGrowth: 444077,
    followersGrowthFormatted: "444.08K",
    followersGrowthPercent: 0.26,
    followers7DayGrowth: 416249,
    followers7DayGrowthPercent: 0.24,
    followers28DayGrowth: 727029,
    followers28DayGrowthPercent: 0.43,
    followers60DayGrowth: 5228180,
    followers60DayGrowthPercent: 3.07,
    popularity: 77,
    popularityChange: -5,
    popularityChangePercent: -6.49,
    playlistReach: 178421053,
    playlistReachFormatted: "178.42M",
    playlistReachChange: 5866770,
    playlistReachChangeFormatted: "5.87M",
    playlistReachChangePercent: 3.29,
    playlistReach7DayGrowth: 12956144,
    playlistReach7DayGrowthPercent: 7.26,
    playlistReach28DayGrowth: 49427873,
    playlistReach28DayGrowthPercent: 27.7,
    playlistReach60DayGrowth: 59890499,
    playlistReach60DayGrowthPercent: 33.57,
    playlistCount: 2482,
    playlistCountGrowth: 51,
    playlistCountGrowthPercent: 2.05,
    playlistCount7DayGrowth: 5,
    playlistCount7DayGrowthPercent: 0.2,
    playlistCount28DayGrowth: 48,
    playlistCount28DayGrowthPercent: 1.93,
    playlistCount60DayGrowth: 40,
    playlistCount60DayGrowthPercent: 1.61,
    monthlyListeners: 84354631,
    monthlyListenersFormatted: "84.35M",
    monthlyListenersChange: -3933895,
    monthlyListenersChangeFormatted: "-3933895",
    monthlyListenersChangePercent: -4.66,
    monthlyListeners7DayGrowth: 4867147,
    monthlyListeners7DayGrowthPercent: 5.77,
    monthlyListeners28DayGrowth: 3042375,
    monthlyListeners28DayGrowthPercent: 3.61,
    monthlyListeners60DayGrowth: -38687,
    monthlyListeners60DayGrowthPercent: -0.05,
    conversionRate: 9.43,
    reachFollowersRatio: 1.05,
  },
];

export default function MusicExample({
  height,
  theme,
  rowCount = 50,
}: {
  height?: string;
  theme?: Theme;
  rowCount?: number;
}) {
  const tableRef = useRef<TableRefType | null>(null);
  const [data, setData] = useState<Row[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  // Fetch music data from API
  useEffect(() => {
    const fetchData = async () => {
      try {
        setIsLoading(true);
        const isLocal = typeof window !== "undefined" && window.location.hostname === "localhost";
        const isProduction =
          typeof window !== "undefined" && window.location.hostname.includes("simple-table.com");

        // Use backup data if not on localhost or production
        if (!isLocal && !isProduction) {
          setData(BACKUP_MUSIC_DATA);
          setIsLoading(false);
          return;
        }

        // Use relative path for local development, full URL for production
        const baseUrl = isLocal ? "" : "https://www.simple-table.com";
        const response = await fetch(`${baseUrl}/api/data/music?rowCount=${rowCount}`);
        if (!response.ok) {
          throw new Error("Failed to fetch music data");
        }
        const musicData = await response.json();
        setData(musicData);
      } catch (error) {
        console.error("Error fetching music data:", error);
        // Fallback to backup data on error
        setData(BACKUP_MUSIC_DATA);
      } finally {
        setIsLoading(false);
      }
    };

    fetchData();
  }, [rowCount]);

  if (isLoading) {
    return (
      <div
        style={{
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          height: height ? height : "70dvh",
          fontSize: "16px",
          color: "#666",
        }}
      >
        Loading music artist data...
      </div>
    );
  }

  return (
    <div className="music-theme-container" style={{ fontFamily: "Inter" }}>
      <SimpleTable
        columnReordering
        columnResizing
        defaultHeaders={HEADERS}
        height={height ? height : "70dvh"}
        rowHeight={85}
        rowIdAccessor="id"
        rows={data}
        selectableCells
        tableRef={tableRef}
        headerHeight={30}
        theme={theme}
      />
    </div>
  );
}
